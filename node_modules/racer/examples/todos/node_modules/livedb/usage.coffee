# Not actual code...

client = alive.client()

client.create 'users', 'ben', 'json', (err) -> console.log 'waah', err
client.submit 'users', 'ben', v:0, type:

client.submit 'users', 'ben', v:5, ops:[{op:'set', ['foo'], val:'hi'}], id:'abc123', (err, v) ->
  console.log 'op submitted at version', v

client.observe 'users', 'ben', 5, (err, stream) ->
  stream.on 'readable', ->
    {v, ops, id} = stream.read()
    console.log "#{ops} at #{v} from #{id}"
  stream.on 'error', (e) -> console.log 'error', e
  stream.on 'close', -> # ...
  stream.destroy()

client.fetch 'users', 'ben', (err, {v, snapsnot}) ->
  console.log "ben is at #{v} '#{snapshot}'"

client.fetchAndObserve 'users', 'ben', (err, {v, snapshot}, stream) ->
  console.log "ben is at #{v} '#{snapshot}'"
  # ...
  stream.destroy()

client.query 'users', {age:{$gt:50}}, autosubscribe:no, (err, refs, stream) ->
  stream.on 'remove', (id) -> refs.remove id
  stream.on 'add', (id) -> refs.push id

  stream.destroy()

