(function(){var e={exports:{}};e.exports;var t=e.exports={name:"text-tp2",tp2:!0,uri:"http://sharejs.org/types/text-tp2v1",create:function(e){if(null==e)e="";else if("string"!=typeof e)throw Error("Initial data must be a string");return{charLength:e.length,totalLength:e.length,data:e.length?[e]:[]}},serialize:function(e){if(!e.data)throw Error("invalid doc snapshot");return e.data},deserialize:function(e){var r=t.create();r.data=e;for(var n=0;e.length>n;n++){var o=e[n];"string"==typeof o?(r.charLength+=o.length,r.totalLength+=o.length):r.totalLength+=o}return r}},r=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},n=function(e){if(!r(e))throw Error("Op must be an array of components");for(var t=null,n=0;e.length>n;n++){var o=e[n];if("object"==typeof o)if(void 0!==o.i){if(!("string"==typeof o.i&&o.i.length>0||"number"==typeof o.i&&o.i>0))throw Error("Inserts must insert a string or a +ive number")}else{if(void 0===o.d)throw Error("Operation component must define .i or .d");if(!("number"==typeof o.d&&o.d>0))throw Error("Deletes must be a +ive number")}else{if("number"!=typeof o)throw Error("Op components must be objects or numbers");if(0>=o)throw Error("Skip components must be a positive number");if("number"==typeof t)throw Error("Adjacent skip components should be combined")}t=o}},o=t._takeDoc=function(e,t,r,n){if(t.index>=e.data.length)throw Error("Operation goes past the end of the document");var o,i=e.data[t.index];o="string"==typeof i?null!=r?i.slice(t.offset,t.offset+r):i.slice(t.offset):null==r||n?i-t.offset:Math.min(r,i-t.offset);var f=o.length||o;return(i.length||i)-t.offset>f?t.offset+=f:(t.index++,t.offset=0),o},i=t._appendDoc=function(e,t){if(0!==t&&""!==t){"string"==typeof t?(e.charLength+=t.length,e.totalLength+=t.length):e.totalLength+=t;var r=e.data;0===r.length?r.push(t):typeof r[r.length-1]==typeof t?r[r.length-1]+=t:r.push(t)}};t.apply=function(e,f){if(null==e.totalLength||null==e.charLength||!r(e.data))throw Error("Snapshot is invalid");n(f);for(var l=t.create(),a={index:0,offset:0},u=0;f.length>u;u++){var s,h,p=f[u];if("number"==typeof p)for(s=p;s>0;)h=o(e,a,s),i(l,h),s-=h.length||h;else if(void 0!==p.i)i(l,p.i);else if(void 0!==p.d){for(s=p.d;s>0;)h=o(e,a,s),s-=h.length||h;i(l,p.d)}}return l};var f=t._append=function(e,t){var r;0===t||""===t.i||0===t.i||0===t.d||(0===e.length?e.push(t):(r=e[e.length-1],"number"==typeof t&&"number"==typeof r?e[e.length-1]+=t:null!=t.i&&null!=r.i&&typeof r.i==typeof t.i?r.i+=t.i:null!=t.d&&null!=r.d?r.d+=t.d:e.push(t)))},l=function(e){var t=0,r=0,n=function(n,o){if(t===e.length)return null;var i,f,l=e[t];if("number"==typeof(i=l)||"number"==typeof(i=l.i)||null!=(i=l.d)){var a;return null==n||n>=i-r||o&&null!=l.i?(a=i-r,++t,r=0):(r+=n,a=n),null!=l.i?{i:a}:null!=l.d?{d:a}:a}return null==n||n>=l.i.length-r||o?(f={i:l.i.slice(r)},++t,r=0):(f={i:l.i.slice(r,r+n)},r+=n),f},o=function(){return e[t]};return[n,o]},a=function(e){return"number"==typeof e?e:"string"==typeof e.i?e.i.length:e.d||e.i};t.normalize=function(e){for(var t=[],r=0;e.length>r;r++)f(t,e[r]);return t};var u=function(e,t,r,o){n(e),n(t);for(var i=[],u=l(e),s=u[0],h=u[1],p=0;t.length>p;p++){var d,g=t[p],c=a(g);if(null!=g.i)if(r){if("left"===o)for(var m;(m=h())&&null!=m.i;)f(i,s());f(i,c)}else for(;c>0;){if(d=s(c,!0),null===d)throw Error("The transformed op is invalid");if(null!=d.d)throw Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");"number"==typeof d?c-=d:f(i,d)}else for(;c>0;){if(d=s(c,!0),null===d)throw Error("The op traverses more elements than the document has");f(i,d),d.i||(c-=a(d))}}for(var g;g=s();){if(void 0===g.i)throw Error("Remaining fragments in the op: "+g);f(i,g)}return i};t.transform=function(e,t,r){if("left"!=r&&"right"!=r)throw Error("side ("+r+") should be 'left' or 'right'");return u(e,t,!0,r)},t.prune=function(e,t){return u(e,t,!1)},t.compose=function(e,t){if(null==e)return t;n(e),n(t);for(var r,o=[],i=l(e)[0],u=0;t.length>u;u++){r=t[u];var s,h;if("number"==typeof r)for(s=r;s>0;){if(h=i(s),null===h)throw Error("The op traverses more elements than the document has");f(o,h),s-=a(h)}else if(void 0!==r.i)f(o,{i:r.i});else for(s=r.d;s>0;){if(h=i(s),null===h)throw Error("The op traverses more elements than the document has");var p=a(h);void 0!==h.i?f(o,{i:p}):f(o,{d:p}),s-=p}}for(;r=i();){if(void 0===r.i)throw Error("Remaining fragments in op1: "+r);f(o,r)}return o};var s=window.ottypes=window.ottypes||{},h=e.exports;s[h.name]=h,h.uri&&(s[h.uri]=h)})();