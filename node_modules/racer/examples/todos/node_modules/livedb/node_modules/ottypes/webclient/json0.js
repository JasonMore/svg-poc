(function(){var e={exports:{}},i=e.exports;i._bootstrapTransform=function(e,i,n,r){var t,l;return t=function(e,n,r,t){return i(r,e,n,"left"),i(t,n,e,"right")},e.transformX=e.transformX=l=function(e,i){var o,p,d,f,s,a,u,v,h,c,g,m,y,w,O,b,E,k,x;for(n(e),n(i),s=[],c=0,w=i.length;w>c;c++){for(h=i[c],f=[],o=0;e.length>o;){if(a=[],t(e[o],h,f,a),o++,1!==a.length){if(0===a.length){for(k=e.slice(o),g=0,O=k.length;O>g;g++)p=k[g],r(f,p);h=null;break}for(x=l(e.slice(o),a),d=x[0],v=x[1],m=0,b=d.length;b>m;m++)p=d[m],r(f,p);for(y=0,E=v.length;E>y;y++)u=v[y],r(s,u);h=null;break}h=a[0]}null!=h&&r(s,h),e=f}return[e,s]},e.transform=e.transform=function(e,n,r){if("left"!==r&&"right"!==r)throw Error("type must be 'left' or 'right'");return 0===n.length?e:1===e.length&&1===n.length?i([],e[0],n[0],r):"left"===r?l(e,n)[0]:l(n,e)[1]}};var n=e.exports={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(e){if(null!=e&&"string"!=typeof e)throw Error("Initial data must be a string");return e||""}},r=function(e,i,n){return e.slice(0,i)+n+e.slice(i)},t=function(e){if("number"!=typeof e.p)throw Error("component missing position field");if("string"==typeof e.i==("string"==typeof e.d))throw Error("component needs an i or d field");if(0>e.p)throw Error("position cannot be negative")},l=function(e){for(var i=0;e.length>i;i++)t(e[i])};n.apply=function(e,i){var n;l(i);for(var t=0;i.length>t;t++){var o=i[t];if(null!=o.i)e=r(e,o.p,o.i);else{if(n=e.slice(o.p,o.p+o.d.length),o.d!==n)throw Error("Delete component '"+o.d+"' does not match deleted text '"+n+"'");e=e.slice(0,o.p)+e.slice(o.p+o.d.length)}}return e};var o=n._append=function(e,i){if(""!==i.i&&""!==i.d)if(0===e.length)e.push(i);else{var n=e[e.length-1];null!=n.i&&null!=i.i&&n.p<=i.p&&i.p<=n.p+n.i.length?e[e.length-1]={i:r(n.i,i.p-n.p,i.i),p:n.p}:null!=n.d&&null!=i.d&&i.p<=n.p&&n.p<=i.p+i.d.length?e[e.length-1]={d:r(i.d,n.p-i.p,n.d),p:i.p}:e.push(i)}};n.compose=function(e,i){l(e),l(i);for(var n=e.slice(),r=0;i.length>r;r++)o(n,i[r]);return n},n.normalize=function(e){var i=[];(null!=e.i||null!=e.p)&&(e=[e]);for(var n=0;e.length>n;n++){var r=e[n];null==r.p&&(r.p=0),o(i,r)}return i};var p=function(e,i,n){return null!=i.i?e>i.p||i.p===e&&n?e+i.i.length:e:i.p>=e?e:i.p+i.d.length>=e?i.p:e-i.d.length};n.transformCursor=function(e,i,n){for(var r="right"===n,t=0;i.length>t;t++)e=p(e,i[t],r);return e};var d=n._tc=function(e,i,n,r){if(t(i),t(n),null!=i.i)o(e,{i:i.i,p:p(i.p,n,"right"===r)});else if(null!=n.i){var l=i.d;i.p<n.p&&(o(e,{d:l.slice(0,n.p-i.p),p:i.p}),l=l.slice(n.p-i.p)),""!==l&&o(e,{d:l,p:i.p+n.i.length})}else if(i.p>=n.p+n.d.length)o(e,{d:i.d,p:i.p-n.d.length});else if(i.p+i.d.length<=n.p)o(e,i);else{var d={d:"",p:i.p};i.p<n.p&&(d.d=i.d.slice(0,n.p-i.p)),i.p+i.d.length>n.p+n.d.length&&(d.d+=i.d.slice(n.p+n.d.length-i.p));var f=Math.max(i.p,n.p),s=Math.min(i.p+i.d.length,n.p+n.d.length),a=i.d.slice(f-i.p,s-i.p),u=n.d.slice(f-n.p,s-n.p);if(a!==u)throw Error("Delete ops delete different text in the same region of the document");""!==d.d&&(d.p=p(d.p,n),o(e,d))}return e},f=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}};n.invert=function(e){e=e.slice().reverse();for(var i=0;e.length>i;i++)e[i]=f(e[i]);return e},"undefined"==typeof require?i._bootstrapTransform(n,d,l,o):require("./helpers")._bootstrapTransform(n,d,l,o);var s=function(e){return"[object Array]"==Object.prototype.toString.call(e)},a=function(e){return JSON.parse(JSON.stringify(e))};if(n===void 0)var n="undefined"!=typeof require?require("./text0"):window.ottypes.text;var u={name:"json0",uri:"http://sharejs.org/types/JSONv0"};u.create=function(e){return void 0===e?null:e},u.invertComponent=function(e){var i={p:e.p};return void 0!==e.si&&(i.sd=e.si),void 0!==e.sd&&(i.si=e.sd),void 0!==e.oi&&(i.od=e.oi),void 0!==e.od&&(i.oi=e.od),void 0!==e.li&&(i.ld=e.li),void 0!==e.ld&&(i.li=e.ld),void 0!==e.na&&(i.na=-e.na),void 0!==e.lm&&(i.lm=e.p[e.p.length-1],i.p=e.p.slice(0,e.p.length-1).concat([e.lm])),i},u.invert=function(e){for(var i=e.slice().reverse(),n=[],r=0;i.length>r;r++)n.push(u.invertComponent(i[r]));return n},u.checkValidOp=function(e){for(var i=0;e.length>i;i++)if(!s(e[i].p))throw Error("Missing path")},u.checkList=function(e){if(!s(e))throw Error("Referenced element not a list")},u.checkObj=function(e){if(e.constructor!==Object)throw Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},u.apply=function(e,i){u.checkValidOp(i),i=a(i);for(var n={data:e},r=0;i.length>r;r++){for(var t=i[r],l=null,o=null,p=n,d="data",f=0;t.p.length>f;f++){var s=t.p[f];if(l=p,o=d,p=p[d],d=s,null==l)throw Error("Path invalid")}if(void 0!==t.na){if("number"!=typeof p[d])throw Error("Referenced element not a number");p[d]+=t.na}else if(void 0!==t.si){if("string"!=typeof p)throw Error("Referenced element not a string (it was "+JSON.stringify(p)+")");l[o]=p.slice(0,d)+t.si+p.slice(d)}else if(void 0!==t.sd){if("string"!=typeof p)throw Error("Referenced element not a string");if(p.slice(d,d+t.sd.length)!==t.sd)throw Error("Deleted string does not match");l[o]=p.slice(0,d)+p.slice(d+t.sd.length)}else if(void 0!==t.li&&void 0!==t.ld)u.checkList(p),p[d]=t.li;else if(void 0!==t.li)u.checkList(p),p.splice(d,0,t.li);else if(void 0!==t.ld)u.checkList(p),p.splice(d,1);else if(void 0!==t.lm){if(u.checkList(p),t.lm!=d){var v=p[d];p.splice(d,1),p.splice(t.lm,0,v)}}else if(void 0!==t.oi)u.checkObj(p),p[d]=t.oi;else{if(void 0===t.od)throw Error("invalid / missing instruction in op");u.checkObj(p),delete p[d]}}return n.data},u.incrementalApply=function(e,i,n){for(var r=0;i.length>r;r++){var t=[i[r]];e=u.apply(e,t),n(t,e)}return e};var v=u.pathMatches=function(e,i,n){if(e.length!=i.length)return!1;for(var r=0;e.length>r;r++)if(e[r]!==i[r]&&(!n||r!==e.length-1))return!1;return!0},h=function(e){var i={p:e.p[e.p.length-1]};return null!=e.si?i.i=e.si:i.d=e.sd,i};u.append=function(e,i){i=a(i);var r;if(0!=e.length&&v(i.p,(r=e[e.length-1]).p))null!=r.na&&null!=i.na?e[e.length-1]={p:r.p,na:r.na+i.na}:void 0!==r.li&&void 0===i.li&&i.ld===r.li?void 0!==r.ld?delete r.li:e.pop():void 0!==r.od&&void 0===r.oi&&void 0!==i.oi&&void 0===i.od?r.oi=i.oi:void 0!==r.oi&&void 0!==i.od?void 0!==i.oi?r.oi=i.oi:void 0!==r.od?delete r.oi:e.pop():void 0!==i.lm&&i.p[i.p.length-1]===i.lm||e.push(i);else if(0!=e.length&&v(i.p,r.p,!0))if(null==i.si&&null==i.sd||null==r.si&&null==r.sd)e.push(i);else{var t=[h(r)];if(n._append(t,h(i)),1!==t.length)e.push(i);else{var l=t[0];r.p[r.p.length-1]=l.p,null!=l.i?r.si=l.i:r.sd=l.d}}else e.push(i)},u.compose=function(e,i){u.checkValidOp(e),u.checkValidOp(i);for(var n=a(e),r=0;i.length>r;r++)u.append(n,i[r]);return n},u.normalize=function(e){var i=[];e=s(e)?e:[e];for(var n=0;e.length>n;n++){var r=e[n];null==r.p&&(r.p=[]),u.append(i,r)}return i},u.canOpAffectOp=function(e,i){if(0===e.length)return!0;if(0===i.length)return!1;i=i.slice(0,i.length-1),e=e.slice(0,e.length-1);for(var n=0;e.length>n;n++){var r=e[n];if(n>=i.length||r!=i[n])return!1}return!0},u.transformComponent=function(e,i,r,t){i=a(i),void 0!==i.na&&i.p.push(0),void 0!==r.na&&r.p.push(0);var l;u.canOpAffectOp(r.p,i.p)&&(l=r.p.length-1);var o;u.canOpAffectOp(i.p,r.p)&&(o=i.p.length-1);var p=i.p.length,d=r.p.length;if(void 0!==i.na&&i.p.pop(),void 0!==r.na&&r.p.pop(),r.na){if(null!=o&&d>=p&&r.p[o]==i.p[o])if(void 0!==i.ld){var f=a(r);f.p=f.p.slice(p),i.ld=u.apply(a(i.ld),[f])}else if(void 0!==i.od){var f=a(r);f.p=f.p.slice(p),i.od=u.apply(a(i.od),[f])}return u.append(e,i),e}if(null!=o&&d>p&&i.p[o]==r.p[o])if(void 0!==i.ld){var f=a(r);f.p=f.p.slice(p),i.ld=u.apply(a(i.ld),[f])}else if(void 0!==i.od){var f=a(r);f.p=f.p.slice(p),i.od=u.apply(a(i.od),[f])}if(null!=l){var s=p==d;if(void 0!==r.na);else if(void 0!==r.si||void 0!==r.sd){if(void 0!==i.si||void 0!==i.sd){if(!s)throw Error("must be a string?");var v=h(i),c=h(r),g=[];n._tc(g,v,c,t);for(var m=0;g.length>m;m++){var y=g[m],w={p:i.p.slice(0,l)};w.p.push(y.p),null!=y.i&&(w.si=y.i),null!=y.d&&(w.sd=y.d),u.append(e,w)}return e}}else if(void 0!==r.li&&void 0!==r.ld){if(r.p[l]===i.p[l]){if(!s)return e;if(void 0!==i.ld){if(void 0===i.li||"left"!==t)return e;i.ld=a(r.li)}}}else if(void 0!==r.li)void 0!==i.li&&void 0===i.ld&&s&&i.p[l]===r.p[l]?"right"===t&&i.p[l]++:r.p[l]<=i.p[l]&&i.p[l]++,void 0!==i.lm&&s&&r.p[l]<=i.lm&&i.lm++;else if(void 0!==r.ld){if(void 0!==i.lm&&s){if(r.p[l]===i.p[l])return e;var O=r.p[l],b=i.p[l],E=i.lm;(E>O||O===E&&E>b)&&i.lm--}if(r.p[l]<i.p[l])i.p[l]--;else if(r.p[l]===i.p[l]){if(p>d)return e;if(void 0!==i.ld){if(void 0===i.li)return e;delete i.ld}}}else if(void 0!==r.lm)if(void 0!==i.lm&&p===d){var b=i.p[l],E=i.lm,k=r.p[l],x=r.lm;if(k!==x)if(b===k){if("left"!==t)return e;i.p[l]=x,b===E&&(i.lm=x)}else b>k&&i.p[l]--,b>x?i.p[l]++:b===x&&k>x&&(i.p[l]++,b===E&&i.lm++),E>k?i.lm--:E===k&&E>b&&i.lm--,E>x?i.lm++:E===x&&(x>k&&E>b||k>x&&b>E?"right"===t&&i.lm++:E>b?i.lm++:E===k&&i.lm--)}else if(void 0!==i.li&&void 0===i.ld&&s){var b=r.p[l],E=r.lm;O=i.p[l],O>b&&i.p[l]--,O>E&&i.p[l]++}else{var b=r.p[l],E=r.lm;O=i.p[l],O===b?i.p[l]=E:(O>b&&i.p[l]--,O>E?i.p[l]++:O===E&&b>E&&i.p[l]++)}else if(void 0!==r.oi&&void 0!==r.od){if(i.p[l]===r.p[l]){if(void 0===i.oi||!s)return e;if("right"===t)return e;i.od=r.oi}}else if(void 0!==r.oi){if(void 0!==i.oi&&i.p[l]===r.p[l]){if("left"!==t)return e;u.append(e,{p:i.p,od:r.oi})}}else if(void 0!==r.od&&i.p[l]==r.p[l]){if(!s)return e;if(void 0===i.oi)return e;delete i.od}}return u.append(e,i),e},"undefined"!=typeof require?require("./helpers")._bootstrapTransform(u,u.transformComponent,u.checkValidOp,u.append):i._bootstrapTransform(u,u.transformComponent,u.checkValidOp,u.append),e.exports=u;var c=window.ottypes=window.ottypes||{},g=e.exports;c[g.name]=g,g.uri&&(c[g.uri]=g)})();