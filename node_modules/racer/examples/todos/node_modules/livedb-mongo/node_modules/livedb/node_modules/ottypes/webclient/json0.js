(function(){var e={exports:{}},i=e.exports;i._bootstrapTransform=function(e,i,r,n){var t=function(e,r,n,t){i(n,e,r,"left"),i(t,r,e,"right")},l=e.transformX=function(e,i){r(e),r(i);for(var o=[],p=0;i.length>p;p++){for(var d=i[p],f=[],s=0;e.length>s;){var a=[];if(t(e[s],d,f,a),s++,1!==a.length){if(0===a.length){for(var u=s;e.length>u;u++)n(f,e[u]);d=null;break}for(var v=l(e.slice(s),a),h=0;v[0].length>h;h++)n(f,v[0][h]);for(var c=0;v[1].length>c;c++)n(o,v[1][c]);d=null;break}d=a[0]}null!=d&&n(o,d),e=f}return[e,o]};e.transform=e.transform=function(e,r,n){if("left"!==n&&"right"!==n)throw Error("type must be 'left' or 'right'");return 0===r.length?e:1===e.length&&1===r.length?i([],e[0],r[0],n):"left"===n?l(e,r)[0]:l(r,e)[1]}};var r=e.exports={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(e){if(null!=e&&"string"!=typeof e)throw Error("Initial data must be a string");return e||""}},n=function(e,i,r){return e.slice(0,i)+r+e.slice(i)},t=function(e){if("number"!=typeof e.p)throw Error("component missing position field");if("string"==typeof e.i==("string"==typeof e.d))throw Error("component needs an i or d field");if(0>e.p)throw Error("position cannot be negative")},l=function(e){for(var i=0;e.length>i;i++)t(e[i])};r.apply=function(e,i){var r;l(i);for(var t=0;i.length>t;t++){var o=i[t];if(null!=o.i)e=n(e,o.p,o.i);else{if(r=e.slice(o.p,o.p+o.d.length),o.d!==r)throw Error("Delete component '"+o.d+"' does not match deleted text '"+r+"'");e=e.slice(0,o.p)+e.slice(o.p+o.d.length)}}return e};var o=r._append=function(e,i){if(""!==i.i&&""!==i.d)if(0===e.length)e.push(i);else{var r=e[e.length-1];null!=r.i&&null!=i.i&&r.p<=i.p&&i.p<=r.p+r.i.length?e[e.length-1]={i:n(r.i,i.p-r.p,i.i),p:r.p}:null!=r.d&&null!=i.d&&i.p<=r.p&&r.p<=i.p+i.d.length?e[e.length-1]={d:n(i.d,r.p-i.p,r.d),p:i.p}:e.push(i)}};r.compose=function(e,i){l(e),l(i);for(var r=e.slice(),n=0;i.length>n;n++)o(r,i[n]);return r},r.normalize=function(e){var i=[];(null!=e.i||null!=e.p)&&(e=[e]);for(var r=0;e.length>r;r++){var n=e[r];null==n.p&&(n.p=0),o(i,n)}return i};var p=function(e,i,r){return null!=i.i?e>i.p||i.p===e&&r?e+i.i.length:e:i.p>=e?e:i.p+i.d.length>=e?i.p:e-i.d.length};r.transformCursor=function(e,i,r){for(var n="right"===r,t=0;i.length>t;t++)e=p(e,i[t],n);return e};var d=r._tc=function(e,i,r,n){if(t(i),t(r),null!=i.i)o(e,{i:i.i,p:p(i.p,r,"right"===n)});else if(null!=r.i){var l=i.d;i.p<r.p&&(o(e,{d:l.slice(0,r.p-i.p),p:i.p}),l=l.slice(r.p-i.p)),""!==l&&o(e,{d:l,p:i.p+r.i.length})}else if(i.p>=r.p+r.d.length)o(e,{d:i.d,p:i.p-r.d.length});else if(i.p+i.d.length<=r.p)o(e,i);else{var d={d:"",p:i.p};i.p<r.p&&(d.d=i.d.slice(0,r.p-i.p)),i.p+i.d.length>r.p+r.d.length&&(d.d+=i.d.slice(r.p+r.d.length-i.p));var f=Math.max(i.p,r.p),s=Math.min(i.p+i.d.length,r.p+r.d.length),a=i.d.slice(f-i.p,s-i.p),u=r.d.slice(f-r.p,s-r.p);if(a!==u)throw Error("Delete ops delete different text in the same region of the document");""!==d.d&&(d.p=p(d.p,r),o(e,d))}return e},f=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}};r.invert=function(e){e=e.slice().reverse();for(var i=0;e.length>i;i++)e[i]=f(e[i]);return e},"undefined"==typeof require?i._bootstrapTransform(r,d,l,o):require("./helpers")._bootstrapTransform(r,d,l,o);var s=function(e){return"[object Array]"==Object.prototype.toString.call(e)},a=function(e){return JSON.parse(JSON.stringify(e))};if(r===void 0)var r="undefined"!=typeof require?require("./text0"):window.ottypes.text;var u={name:"json0",uri:"http://sharejs.org/types/JSONv0"};u.create=function(e){return void 0===e?null:e},u.invertComponent=function(e){var i={p:e.p};return void 0!==e.si&&(i.sd=e.si),void 0!==e.sd&&(i.si=e.sd),void 0!==e.oi&&(i.od=e.oi),void 0!==e.od&&(i.oi=e.od),void 0!==e.li&&(i.ld=e.li),void 0!==e.ld&&(i.li=e.ld),void 0!==e.na&&(i.na=-e.na),void 0!==e.lm&&(i.lm=e.p[e.p.length-1],i.p=e.p.slice(0,e.p.length-1).concat([e.lm])),i},u.invert=function(e){for(var i=e.slice().reverse(),r=[],n=0;i.length>n;n++)r.push(u.invertComponent(i[n]));return r},u.checkValidOp=function(e){for(var i=0;e.length>i;i++)if(!s(e[i].p))throw Error("Missing path")},u.checkList=function(e){if(!s(e))throw Error("Referenced element not a list")},u.checkObj=function(e){if(e.constructor!==Object)throw Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},u.apply=function(e,i){u.checkValidOp(i),i=a(i);for(var r={data:e},n=0;i.length>n;n++){for(var t=i[n],l=null,o=null,p=r,d="data",f=0;t.p.length>f;f++){var s=t.p[f];if(l=p,o=d,p=p[d],d=s,null==l)throw Error("Path invalid")}if(void 0!==t.na){if("number"!=typeof p[d])throw Error("Referenced element not a number");p[d]+=t.na}else if(void 0!==t.si){if("string"!=typeof p)throw Error("Referenced element not a string (it was "+JSON.stringify(p)+")");l[o]=p.slice(0,d)+t.si+p.slice(d)}else if(void 0!==t.sd){if("string"!=typeof p)throw Error("Referenced element not a string");if(p.slice(d,d+t.sd.length)!==t.sd)throw Error("Deleted string does not match");l[o]=p.slice(0,d)+p.slice(d+t.sd.length)}else if(void 0!==t.li&&void 0!==t.ld)u.checkList(p),p[d]=t.li;else if(void 0!==t.li)u.checkList(p),p.splice(d,0,t.li);else if(void 0!==t.ld)u.checkList(p),p.splice(d,1);else if(void 0!==t.lm){if(u.checkList(p),t.lm!=d){var v=p[d];p.splice(d,1),p.splice(t.lm,0,v)}}else if(void 0!==t.oi)u.checkObj(p),p[d]=t.oi;else{if(void 0===t.od)throw Error("invalid / missing instruction in op");u.checkObj(p),delete p[d]}}return r.data},u.incrementalApply=function(e,i,r){for(var n=0;i.length>n;n++){var t=[i[n]];e=u.apply(e,t),r(t,e)}return e};var v=u.pathMatches=function(e,i,r){if(e.length!=i.length)return!1;for(var n=0;e.length>n;n++)if(e[n]!==i[n]&&(!r||n!==e.length-1))return!1;return!0},h=function(e){var i={p:e.p[e.p.length-1]};return null!=e.si?i.i=e.si:i.d=e.sd,i};u.append=function(e,i){i=a(i);var n;if(0!=e.length&&v(i.p,(n=e[e.length-1]).p))null!=n.na&&null!=i.na?e[e.length-1]={p:n.p,na:n.na+i.na}:void 0!==n.li&&void 0===i.li&&i.ld===n.li?void 0!==n.ld?delete n.li:e.pop():void 0!==n.od&&void 0===n.oi&&void 0!==i.oi&&void 0===i.od?n.oi=i.oi:void 0!==n.oi&&void 0!==i.od?void 0!==i.oi?n.oi=i.oi:void 0!==n.od?delete n.oi:e.pop():void 0!==i.lm&&i.p[i.p.length-1]===i.lm||e.push(i);else if(0!=e.length&&v(i.p,n.p,!0))if(null==i.si&&null==i.sd||null==n.si&&null==n.sd)e.push(i);else{var t=[h(n)];if(r._append(t,h(i)),1!==t.length)e.push(i);else{var l=t[0];n.p[n.p.length-1]=l.p,null!=l.i?n.si=l.i:n.sd=l.d}}else e.push(i)},u.compose=function(e,i){u.checkValidOp(e),u.checkValidOp(i);for(var r=a(e),n=0;i.length>n;n++)u.append(r,i[n]);return r},u.normalize=function(e){var i=[];e=s(e)?e:[e];for(var r=0;e.length>r;r++){var n=e[r];null==n.p&&(n.p=[]),u.append(i,n)}return i},u.canOpAffectOp=function(e,i){if(0===e.length)return!0;if(0===i.length)return!1;i=i.slice(0,i.length-1),e=e.slice(0,e.length-1);for(var r=0;e.length>r;r++){var n=e[r];if(r>=i.length||n!=i[r])return!1}return!0},u.transformComponent=function(e,i,n,t){i=a(i),void 0!==i.na&&i.p.push(0),void 0!==n.na&&n.p.push(0);var l;u.canOpAffectOp(n.p,i.p)&&(l=n.p.length-1);var o;u.canOpAffectOp(i.p,n.p)&&(o=i.p.length-1);var p=i.p.length,d=n.p.length;if(void 0!==i.na&&i.p.pop(),void 0!==n.na&&n.p.pop(),n.na){if(null!=o&&d>=p&&n.p[o]==i.p[o])if(void 0!==i.ld){var f=a(n);f.p=f.p.slice(p),i.ld=u.apply(a(i.ld),[f])}else if(void 0!==i.od){var f=a(n);f.p=f.p.slice(p),i.od=u.apply(a(i.od),[f])}return u.append(e,i),e}if(null!=o&&d>p&&i.p[o]==n.p[o])if(void 0!==i.ld){var f=a(n);f.p=f.p.slice(p),i.ld=u.apply(a(i.ld),[f])}else if(void 0!==i.od){var f=a(n);f.p=f.p.slice(p),i.od=u.apply(a(i.od),[f])}if(null!=l){var s=p==d;if(void 0!==n.na);else if(void 0!==n.si||void 0!==n.sd){if(void 0!==i.si||void 0!==i.sd){if(!s)throw Error("must be a string?");var v=h(i),c=h(n),g=[];r._tc(g,v,c,t);for(var m=0;g.length>m;m++){var y=g[m],w={p:i.p.slice(0,l)};w.p.push(y.p),null!=y.i&&(w.si=y.i),null!=y.d&&(w.sd=y.d),u.append(e,w)}return e}}else if(void 0!==n.li&&void 0!==n.ld){if(n.p[l]===i.p[l]){if(!s)return e;if(void 0!==i.ld){if(void 0===i.li||"left"!==t)return e;i.ld=a(n.li)}}}else if(void 0!==n.li)void 0!==i.li&&void 0===i.ld&&s&&i.p[l]===n.p[l]?"right"===t&&i.p[l]++:n.p[l]<=i.p[l]&&i.p[l]++,void 0!==i.lm&&s&&n.p[l]<=i.lm&&i.lm++;else if(void 0!==n.ld){if(void 0!==i.lm&&s){if(n.p[l]===i.p[l])return e;var O=n.p[l],b=i.p[l],E=i.lm;(E>O||O===E&&E>b)&&i.lm--}if(n.p[l]<i.p[l])i.p[l]--;else if(n.p[l]===i.p[l]){if(p>d)return e;if(void 0!==i.ld){if(void 0===i.li)return e;delete i.ld}}}else if(void 0!==n.lm)if(void 0!==i.lm&&p===d){var b=i.p[l],E=i.lm,k=n.p[l],x=n.lm;if(k!==x)if(b===k){if("left"!==t)return e;i.p[l]=x,b===E&&(i.lm=x)}else b>k&&i.p[l]--,b>x?i.p[l]++:b===x&&k>x&&(i.p[l]++,b===E&&i.lm++),E>k?i.lm--:E===k&&E>b&&i.lm--,E>x?i.lm++:E===x&&(x>k&&E>b||k>x&&b>E?"right"===t&&i.lm++:E>b?i.lm++:E===k&&i.lm--)}else if(void 0!==i.li&&void 0===i.ld&&s){var b=n.p[l],E=n.lm;O=i.p[l],O>b&&i.p[l]--,O>E&&i.p[l]++}else{var b=n.p[l],E=n.lm;O=i.p[l],O===b?i.p[l]=E:(O>b&&i.p[l]--,O>E?i.p[l]++:O===E&&b>E&&i.p[l]++)}else if(void 0!==n.oi&&void 0!==n.od){if(i.p[l]===n.p[l]){if(void 0===i.oi||!s)return e;if("right"===t)return e;i.od=n.oi}}else if(void 0!==n.oi){if(void 0!==i.oi&&i.p[l]===n.p[l]){if("left"!==t)return e;u.append(e,{p:i.p,od:n.oi})}}else if(void 0!==n.od&&i.p[l]==n.p[l]){if(!s)return e;if(void 0===i.oi)return e;delete i.od}}return u.append(e,i),e},"undefined"!=typeof require?require("./helpers")._bootstrapTransform(u,u.transformComponent,u.checkValidOp,u.append):i._bootstrapTransform(u,u.transformComponent,u.checkValidOp,u.append),e.exports=u;var c=window.ottypes=window.ottypes||{},g=e.exports;c[g.name]=g,g.uri&&(c[g.uri]=g)})();