(function(){var e={exports:{}};e.exports;var t,r,o,n,i,f,a,s;e.exports=s={name:"text-tp2",tp2:!0,create:function(){return{charLength:0,totalLength:0,positionCache:[],data:[]}},serialize:function(e){if(!e.data)throw Error("invalid doc snapshot");return e.data},deserialize:function(e){var t,r,o,n;for(r=s.create(),r.data=e,o=0,n=e.length;n>o;o++)t=e[o],"string"==typeof t?(r.charLength+=t.length,r.totalLength+=t.length):r.totalLength+=t;return r}},o=function(e){var t,r,o,n,i;if(!Array.isArray(e))throw Error("Op must be an array of components");for(r=null,i=[],o=0,n=e.length;n>o;o++){if(t=e[o],"object"==typeof t)if(void 0!==t.i){if(!("string"==typeof t.i&&t.i.length>0||"number"==typeof t.i&&t.i>0))throw Error("Inserts must insert a string or a +ive number")}else{if(void 0===t.d)throw Error("Operation component must define .i or .d");if(!("number"==typeof t.d&&t.d>0))throw Error("Deletes must be a +ive number")}else{if("number"!=typeof t)throw Error("Op components must be objects or numbers");if(!(t>0))throw Error("Skip components must be a positive number");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}i.push(r=t)}return i},s._takeDoc=f=function(e,t,r,o){var n,i,f;if(t.index>=e.data.length)throw Error("Operation goes past the end of the document");return n=e.data[t.index],i="string"==typeof n?void 0!==r?n.slice(t.offset,t.offset+r):n.slice(t.offset):void 0===r||o?n-t.offset:Math.min(r,n-t.offset),f=i.length||i,(n.length||n)-t.offset>f?t.offset+=f:(t.index++,t.offset=0),i},s._appendDoc=r=function(e,t){var r;0!==t&&""!==t&&("string"==typeof t?(e.charLength+=t.length,e.totalLength+=t.length):e.totalLength+=t,r=e.data,0===r.length?r.push(t):typeof r[r.length-1]==typeof t?r[r.length-1]+=t:r.push(t))},s.apply=function(e,t){var n,i,a,h,l,u,d;if(void 0===e.totalLength||void 0===e.charLength||void 0===e.data.length)throw Error("Snapshot is invalid");for(o(t),i=s.create(),h={index:0,offset:0},u=0,d=t.length;d>u;u++)if(n=t[u],"number"==typeof n)for(l=n;l>0;)a=f(e,h,l),r(i,a),l-=a.length||a;else if(void 0!==n.i)r(i,n.i);else if(void 0!==n.d){for(l=n.d;l>0;)a=f(e,h,l),l-=a.length||a;r(i,n.d)}return i},s._append=t=function(e,t){var r;return 0!==t&&""!==t.i&&0!==t.i&&0!==t.d?0===e.length?e.push(t):(r=e[e.length-1],"number"==typeof t&&"number"==typeof r?e[e.length-1]+=t:void 0!==t.i&&null!=r.i&&typeof r.i==typeof t.i?r.i+=t.i:void 0!==t.d&&null!=r.d?r.d+=t.d:e.push(t)):void 0},i=function(e){var t,r,o,n;return t=0,r=0,n=function(o,n){var i,f,a,s;return t===e.length?null:(a=e[t],"number"==typeof(f=a)||"number"==typeof(f=a.i)||void 0!==(f=a.d)?(null==o||o>=f-r||n&&void 0!==a.i?(i=f-r,++t,r=0):(r+=o,i=o),void 0!==a.i?{i:i}:void 0!==a.d?{d:i}:i):(null==o||o>=a.i.length-r||n?(s={i:a.i.slice(r)},++t,r=0):(s={i:a.i.slice(r,r+o)},r+=o),s))},o=function(){return e[t]},[n,o]},n=function(e){return"number"==typeof e?e:"string"==typeof e.i?e.i.length:e.d||e.i},s.normalize=function(e){var r,o,n,i;for(o=[],n=0,i=e.length;i>n;n++)r=e[n],t(o,r);return o},a=function(e,r,f,a){var s,h,l,u,d,p,c,g,m,v;for(o(e),o(r),u=[],m=i(e),p=m[0],d=m[1],c=0,g=r.length;g>c;c++)if(h=r[c],l=n(h),void 0!==h.i)if(f){if("left"===a)for(;void 0!==(null!=(v=d())?v.i:void 0);)t(u,p());t(u,l)}else for(;l>0;){if(s=p(l,!0),null===s)throw Error("The transformed op is invalid");if(void 0!==s.d)throw Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");"number"==typeof s?l-=s:t(u,s)}else for(;l>0;){if(s=p(l,!0),null===s)throw Error("The op traverses more elements than the document has");t(u,s),s.i||(l-=n(s))}for(;h=p();){if(void 0===h.i)throw Error("Remaining fragments in the op: "+h);t(u,h)}return u},s.transform=function(e,t,r){if("left"!==r&&"right"!==r)throw Error("side ("+r+") should be 'left' or 'right'");return a(e,t,!0,r)},s.prune=function(e,t){return a(e,t,!1)},s.compose=function(e,r){var f,a,s,h,l,u,d,p,c,g;if(null===e||void 0===e)return r;for(o(e),o(r),l=[],g=i(e),u=g[0],d=g[1],p=0,c=r.length;c>p;p++)if(s=r[p],"number"==typeof s)for(h=s;h>0;){if(f=u(h),null===f)throw Error("The op traverses more elements than the document has");t(l,f),h-=n(f)}else if(void 0!==s.i)t(l,{i:s.i});else for(h=s.d;h>0;){if(f=u(h),null===f)throw Error("The op traverses more elements than the document has");a=n(f),void 0!==f.i?t(l,{i:a}):t(l,{d:a}),h-=a}for(;s=u();){if(void 0===s.i)throw Error("Remaining fragments in op1: "+s);t(l,s)}return l};var h=window.ottypes=window.ottypes||{},l=e.exports;h[l.name]=l,l.uri&&(h[l.uri]=l)})();