/**
 * Dependencies
 */

var request = require('request')
  , path = require('path')
  , fs = require('fs');

/**
 * Remote database locations
 */

var files = {
    kb: 'http://www.browserscope.org/?category=jskb&v=%accuracy%&o=json'
  , modernizer: 'http://www.browserscope.org/?category=usertest_agt1YS1wcm9maWxlcnINCxIEVGVzdBib2KQGDA&v=%accuracy%&o=json'
    }

module.exports = function update (keys, x, fn) {
  var accuracy = {
      major: 1
    , minor: 2
    , all: 3
  };

  // start loading up the database
  (keys || Object.keys(files)).forEach(function (api) {
    request(files[api].replace('%accuracy%', accuracy[x]), function (err, res, data) {
      if (err) return fn(err);
      if (res.statusCode !== 200) return fn(new Error('incorrect status code'));

      // this is going to be painfull, for big json files
      try { var results = JSON.parse(data).results }
      catch (e) { return fn(e) }

      // well we made it, continue parsing down the file
      var useragents = Object.keys(results)
        , i = useragents.length
        , useragent
        , structure = {};

      while (i--) {
        useragent = results[useragents[i]];

      }
    });
 });
}
